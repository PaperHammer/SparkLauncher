<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="SparkLauncher.WinUI.Views.TaskPipeLine"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:SparkLauncher.WinUI.Views"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:taskData="using:SparkLauncher.Tasks"
    xmlns:data="using:SparkLauncher.WinUI.UIComponent.Data"
    Loaded="Page_Loaded"
    mc:Ignorable="d"
    Background="{ThemeResource ApplicationPageBackgroundThemeBrush}">

    <Page.Resources>
        <Style x:Key="TaskPipeLineListContainersStyle" TargetType="ListViewItem">
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ListViewItem">
                        <Grid Background="{TemplateBinding Background}">
                            <VisualStateManager.VisualStateGroups>
                                <VisualStateGroup x:Name="CommonStates">
                                    <VisualState x:Name="Normal"/>
                                    <VisualState x:Name="PointerOver">
                                        <Storyboard>
                                            <DoubleAnimation 
                                                Storyboard.TargetName="BackgroundBorder"
                                                Storyboard.TargetProperty="Opacity"
                                                To="0.3" Duration="0:0:0.1"/>
                                        </Storyboard>
                                    </VisualState>
                                </VisualStateGroup>
                                <VisualStateGroup x:Name="SelectionStates">
                                    <VisualState x:Name="Selected">
                                        <Storyboard>
                                            <DoubleAnimation 
                                                Storyboard.TargetName="ContentPresenter"
                                                Storyboard.TargetProperty="(UIElement.RenderTransform).(ScaleTransform.ScaleX)"
                                                To="0.9" Duration="0:0:0.2"/>
                                            <DoubleAnimation 
                                                Storyboard.TargetName="ContentPresenter"
                                                Storyboard.TargetProperty="(UIElement.RenderTransform).(ScaleTransform.ScaleY)"
                                                To="0.9" Duration="0:0:0.2"/>
                                            <DoubleAnimation 
                                                Storyboard.TargetName="BackgroundBorder"
                                                Storyboard.TargetProperty="Opacity"
                                                To="0.3" Duration="0:0:0.2"/>
                                            <!--<ObjectAnimationUsingKeyFrames 
                                                Storyboard.TargetName="BackgroundBorder"
                                                Storyboard.TargetProperty="Opacity">
                                                <DiscreteObjectKeyFrame KeyTime="0" Value="0.3" />
                                            </ObjectAnimationUsingKeyFrames>-->
                                        </Storyboard>
                                    </VisualState>
                                    <VisualState x:Name="UnSelected">
                                        <Storyboard>
                                            <DoubleAnimation 
                                                Storyboard.TargetName="ContentPresenter"
                                                Storyboard.TargetProperty="(UIElement.RenderTransform).(ScaleTransform.ScaleX)"
                                                To="1" Duration="0:0:0.2"/>
                                            <DoubleAnimation 
                                                Storyboard.TargetName="ContentPresenter"
                                                Storyboard.TargetProperty="(UIElement.RenderTransform).(ScaleTransform.ScaleY)"
                                                To="1" Duration="0:0:0.2"/>
                                            <DoubleAnimation 
                                                Storyboard.TargetName="BackgroundBorder"
                                                Storyboard.TargetProperty="Opacity"
                                                To="0" Duration="0:0:0.2"/>
                                        </Storyboard>
                                    </VisualState>
                                </VisualStateGroup>
                            </VisualStateManager.VisualStateGroups>

                            <ContentPresenter 
                                x:Name="ContentPresenter"                                
                                CornerRadius="4"
                                ContentTemplate="{TemplateBinding ContentTemplate}"
                                Content="{TemplateBinding Content}"
                                RenderTransformOrigin="0.5 0.5">
                                <ContentPresenter.RenderTransform>
                                    <ScaleTransform ScaleX="1" ScaleY="1"/>
                                </ContentPresenter.RenderTransform>
                            </ContentPresenter>

                            <Border 
                                x:Name="BackgroundBorder"
                                BorderBrush="{ThemeResource SystemFillColorAttentionBrush}"
                                Background="{ThemeResource ListViewItemPointerOverBackgroundThemeBrush}"
                                Opacity="0"
                                CornerRadius="4"
                                RenderTransformOrigin="0.5 0.5">
                                <Border.RenderTransform>
                                    <ScaleTransform ScaleX="1" ScaleY="1"/>
                                </Border.RenderTransform>
                            </Border>
                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <DataTemplate x:Key="TaskItemTemplate" x:DataType="taskData:TaskHandler">
            <ListViewItem>
                <data:PendingTaskItem                     
                    TaskName="{Binding TaskName}"                    
                    Status="{Binding Status}"/>
            </ListViewItem>
        </DataTemplate>
    </Page.Resources>

    <Grid
        x:Name="MainGrid"
        Margin="25 15">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="0.3*"/>
            <ColumnDefinition Width="0.7*"/>
        </Grid.ColumnDefinitions>

        <ListView
            x:Name="TaskListView" 
            Padding="0 0 15 0"
            SelectionMode="Single"
            SelectedIndex="{Binding SelectedTaskIdx, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
            ItemsSource="{Binding PendingTaskItems}"
            ItemTemplate="{StaticResource TaskItemTemplate}"
            ItemContainerStyle="{StaticResource TaskPipeLineListContainersStyle}"  
            SingleSelectionFollowsFocus="False"
            SelectionChanged="TaskListView_SelectionChanged"/>

        <ScrollView
            Grid.Column="2" 
            Padding="5 0 15 0"
            Background="{ThemeResource SolidBackgroundFillColorSecondaryBrush}">
            <RichTextBlock
                TextAlignment="Justify"
                Padding="8">
                <Paragraph>
                    <Run Text="{Binding TaskMsg}" />
                </Paragraph>
            </RichTextBlock>
        </ScrollView>
    </Grid>
</Page>
